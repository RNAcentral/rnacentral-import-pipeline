#!/usr/bin/env bash

set -euo pipefail
IFS=$'\n\t'

remote="$1"
pattern="$2"

case "$remote" in
  ssh://* )
    short="${remote:6}"
    scp "$short" .
    ;;
  /* )
    find "$remote" -name "$pattern" | xargs -I {} cp {} .
    ;;
  http://* | https://* )
    wget "$remote"
    ;;
  ftp://* )
    # wget doesn't play well with ** so we use lftp instead. Also, wget doesn't
    # like following symlinks, but lftp does. I should find a way to indicate
    # this to the pipeline.
    if [[ "$remote" =~ '**' ]]; then
      lftp -c "mget $remote"
    else
      wget "$remote"
    fi
    ;;
  * )
    echo 1>&2 "Unknown remote URL to fetch: $remote"
    exit 1;;
esac

case "$remote" in
  *.tar.gz )
    find . -name "*.tar.gz" | xargs -I {} tar xvf {}
esac
