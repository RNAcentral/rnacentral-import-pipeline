manifest {
  mainScript = 'main.nf'
  description = 'Import all RNAcentral data'
}

includeConfig "config/main.config"
includeConfig "config/ftp-export.config"
includeConfig "config/search-export.config"
includeConfig "config/sequence-search-export.config"
includeConfig "config/crs.config"

process {
  container = 'rnacentral/rnacentral-import-pipeline:latest'
}

// local.config must should contain something like the following. I use profiles
// to help control the database I am working with:
// env {
//   PGDATABASE = "postgres://user:password@host:port/name"
// }
includeConfig "local.config"

params.should_release = false
params.needs_publications = false
params.needs_taxonomy = params.databases.gtrnadb.get('run', false) || params.databases.silva.get('run', false)

// Infer the needs_publications and should_release parameters. These are
// basically flags to see if we need to download publications and if we need to
// run the database release logic
for (item in params.databases) {
  def db = item.value;
  def will_run = db.get('run', false);
  if (item.key == 'ensembl') {
    will_run = ['vertebrates', 'plants', 'fungi', 'protsists', 'metazoa'].any {
      db[it].get('run', false)
    }
  }
  if (will_run) {
    params.needs_publications = true;
    if (db.get('release', true)) {
      params.should_release = true;
    }
  }
}
